!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports["easy-cancelable-promise"]=n():e["easy-cancelable-promise"]=n()}(this,(()=>(()=>{"use strict";var e={0:(e,n,r)=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.toCancelablePromise=n.CancelablePromise=void 0;var o,c=r(836),i=r(216),l=r(790);function a(e,n){for(var r=0;r<n.length;r++){var o=n[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(c=o.key,i=void 0,i=function(e,n){if("object"!==t(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,n||"default");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(c,"string"),"symbol"===t(i)?i:String(i)),o)}var c,i}function u(e){var n=d();return function(){var r,o=y(e);if(n){var c=y(this).constructor;r=Reflect.construct(o,arguments,c)}else r=o.apply(this,arguments);return function(e,n){if(n&&("object"===t(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return s(e)}(this,r)}}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,n,r){var t=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=y(e)););return e}(e,n);if(t){var o=Object.getOwnPropertyDescriptor(t,n);return o.get?o.get.call(arguments.length<3?e:r):o.value}},f.apply(this,arguments)}function p(e){var n="function"==typeof Map?new Map:void 0;return p=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return b(e,arguments,y(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),v(t,e)},p(e)}function b(e,n,r){return b=d()?Reflect.construct.bind():function(e,n,r){var t=[null];t.push.apply(t,n);var o=new(Function.bind.apply(e,t));return r&&v(o,r.prototype),o},b.apply(null,arguments)}function d(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function v(e,n){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,n){return e.__proto__=n,e},v(e,n)}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}var m=function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&v(e,n)}(l,e);var n,r,t,i=u(l);function l(e){var n,r,t,a,u,p;return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,l),(a=i.call(this,(function(e,n){u=e,p=n})))[o]=!0,a.status="pending",a.cancelCallbacks=new Set,a.ownCancelCallbacks=new Set,a.onProgressCallbacks=new Set,a.disposeCallbacks=function(){a.cancelCallbacks=new Set,a.ownCancelCallbacks=new Set,a.onProgressCallbacks=new Set},a.subscribeToOwnCancelEvent=function(e){return a.ownCancelCallbacks.add(e),function(){a.ownCancelCallbacks.delete(e)}},a.cancel=function(e){if("pending"!==a.status)return s(a);a.status="canceled";var n=void 0===e?new Error("Promise canceled"):e;return a.ownCancelCallbacks.forEach((function(e){return e(n)})),a.cancelCallbacks.forEach((function(e){return e(n)})),a._reject(n),a.disposeCallbacks(),s(a)},a.onCancel=function(e){var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).signal;return a.cancelCallbacks.add(e),(0,c.isCancelableAbortSignal)(n)?n.subscribe((function(){a.cancelCallbacks.delete(e)})):null==n||n.addEventListener("abort",(function(){a.cancelCallbacks.delete(e)})),s(a)},a.onProgress=function(e){var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).signal;return a.onProgressCallbacks.add(e),(0,c.isCancelableAbortSignal)(n)?n.subscribe((function(){a.onProgressCallbacks.delete(e)})):null==n||n.addEventListener("abort",(function(){a.onProgressCallbacks.delete(e)})),s(a)},a.reportProgress=function(e,n){return a.onProgressCallbacks.forEach((function(r){return r(e,n)})),s(a)},a.createChildPromise=function(){var e,n,r=new l((function(r,t,o){e=r,n=t}));return r.onProgressCallbacks=a.onProgressCallbacks,r.onCancel((function(e){a.cancel(e)})),{promise:r,resolve:e,reject:n}},a._resolve=u,a._reject=p,e((function(e){a.status="resolved",a.disposeCallbacks(),a._resolve(e)}),(function(e){a.status="rejected",a.disposeCallbacks(),a._reject(e)}),{cancel:function(e){return a.cancel(e)},onCancel:function(e){return a.subscribeToOwnCancelEvent(e)},onProgress:function(e){return a.onProgress(e),function(){a.onProgressCallbacks.delete(e)}},reportProgress:function(e,n){a.reportProgress(e,n)}}),a.then=function(e,r){var t=a.createChildPromise(),o=t.promise,c=t.resolve,i=t.reject;return f((n=s(a),y(l.prototype)),"then",n).call(n,e,r).then(c,i),o},a.catch=function(e){var n=a.createChildPromise(),t=n.promise,o=n.resolve,c=n.reject;return f((r=s(a),y(l.prototype)),"catch",r).call(r,e).then(o,c),t},a.finally=function(e){var n=a.createChildPromise(),r=n.promise,o=n.resolve,c=n.reject;return f((t=s(a),y(l.prototype)),"finally",t).call(t,e).then(o,c),r},a}return n=l,t=[{key:"resolve",value:function(e){return new l((function(n){return n(e)}))}}],(r=null)&&a(n.prototype,r),t&&a(n,t),Object.defineProperty(n,"prototype",{writable:!1}),l}(p(Promise));n.CancelablePromise=m,o=i.promise_identifier,m.reject=function(e){return new m((function(n,r){return r(e)}))},m.canceled=function(e){return new m((function(n,r,t){return(0,t.cancel)(e)}))},m.race=function(e){return new m((function(n,r,t){var o=t.onCancel,c=t.cancel;e.forEach((function(e){var t=C(e);o((function(e){t.cancel(e)})),t.then(n,(function(e){"canceled"!==t.status?r(e):c(e)}))}))}))},m.all=function(e){return new m((function(n,r,t){var o=t.onCancel,c=t.cancel,i=new Map,l=e.length,a=0;e.forEach((function(e){var t=C(e);i.set(t,null),o((function(e){t.cancel(e)})),t.then((function(e){a++,i.set(t,e),a===l&&n(Array.from(i.values()))}),(function(e){"canceled"!==t.status?r(e):c(e)}))}))}))},m.allSettled=function(e){return new m((function(n,r,t){var o=t.onCancel,c=new Map,i=e.length,l=0;e.forEach((function(e){var r=C(e);c.set(r,null),o((function(e){r.cancel(e)})),r.then((function(e){c.set(r,{status:"fulfilled",value:e})}),(function(e){c.set(r,{status:"canceled"===r.status?"canceled":"rejected",reason:e})})).finally((function(){++l===i&&n(Array.from(c.values()))}))}))}))},m.prototype.constructor=Promise;var C=function e(n){if((0,i.isCancelablePromise)(n))return n;if("function"==typeof n)return e(n());if(!(0,l.isPromise)(n))return new m((function(e){return e(n)}));var r,t,o=new m((function(e,o,c){r=e,t=o,n.then(r,t)}));return o.onCancel((function(e){t(e)})),o};n.toCancelablePromise=C},836:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.isCancelableAbortSignal=void 0;n.isCancelableAbortSignal=function(e){return Boolean(null==e?void 0:e.__is_cancelable_abort_signal)}},216:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.promise_identifier=n.isCancelablePromise=void 0;var r=Symbol("promise_identifier");n.promise_identifier=r;n.isCancelablePromise=function(e){return!!(null==e?void 0:e[r])}},790:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.isPromise=void 0;n.isPromise=function(e){return Promise.resolve(e)===e}},710:(e,n,r)=>{Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"toCancelablePromise",{enumerable:!0,get:function(){return t.toCancelablePromise}});var t=r(0)}},n={};function r(t){var o=n[t];if(void 0!==o)return o.exports;var c=n[t]={exports:{}};return e[t](c,c.exports,r),c.exports}var t={};return(()=>{var e=t;Object.defineProperty(e,"__esModule",{value:!0}),e.tryCatchPromise=void 0;var n=r(216),o=r(710);e.tryCatchPromise=function(e,r){var t=r||{},c=t.defaultResult,i=void 0===c?null:c,l=t.exceptionHandlingType,a=void 0===l?"error":l,u=t.ignoreCancel,s=void 0===u||u,f=null,p=null,b=function(e){(p=e,"ignore"!=a)&&("canceled"===(null==f?void 0:f.status)&&s||console[a](p))};try{if((0,n.isCancelablePromise)(e))return(f=e).then((function(e){return{error:null,result:e,promise:f}})).catch((function(e){return b(e),{error:e,result:i,promise:f}}));var d=e();return void 0===d?Promise.reject(Error("tryCatchPromise: callback parameter must return a value () => promise")):(f=(0,n.isCancelablePromise)(d)?d:(0,o.toCancelablePromise)(d)).then((function(e){return{error:null,result:e,promise:f}})).catch((function(e){return b(e),{error:e,result:i,promise:f}}))}catch(e){return b(e),Promise.resolve({error:p,result:i,promise:f})}}})(),t})()));