!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports["easy-cancelable-promise"]=n():e["easy-cancelable-promise"]=n()}(this,(()=>(()=>{"use strict";var e={0:(e,n,t)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.toCancelablePromise=n.CancelablePromise=void 0;var o,c=t(836),l=t(216),i=t(790);function a(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(c=o.key,l=void 0,l=function(e,n){if("object"!==r(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,n||"default");if("object"!==r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(c,"string"),"symbol"===r(l)?l:String(l)),o)}var c,l}function u(e){var n=d();return function(){var t,o=y(e);if(n){var c=y(this).constructor;t=Reflect.construct(o,arguments,c)}else t=o.apply(this,arguments);return function(e,n){if(n&&("object"===r(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return s(e)}(this,t)}}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,n,t){var r=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=y(e)););return e}(e,n);if(r){var o=Object.getOwnPropertyDescriptor(r,n);return o.get?o.get.call(arguments.length<3?e:t):o.value}},f.apply(this,arguments)}function p(e){var n="function"==typeof Map?new Map:void 0;return p=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,r)}function r(){return b(e,arguments,y(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),v(r,e)},p(e)}function b(e,n,t){return b=d()?Reflect.construct.bind():function(e,n,t){var r=[null];r.push.apply(r,n);var o=new(Function.bind.apply(e,r));return t&&v(o,t.prototype),o},b.apply(null,arguments)}function d(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function v(e,n){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,n){return e.__proto__=n,e},v(e,n)}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}var m=function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&v(e,n)}(i,e);var n,t,r,l=u(i);function i(e){var n,t,r,a,u,p;return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,i),(a=l.call(this,(function(e,n){u=e,p=n})))[o]=!0,a.status="pending",a.cancelCallbacks=new Set,a.ownCancelCallbacks=new Set,a.onProgressCallbacks=new Set,a.disposeCallbacks=function(){a.cancelCallbacks=new Set,a.ownCancelCallbacks=new Set,a.onProgressCallbacks=new Set},a.subscribeToOwnCancelEvent=function(e){return a.ownCancelCallbacks.add(e),function(){a.ownCancelCallbacks.delete(e)}},a.cancel=function(e){if("pending"!==a.status)return s(a);a.status="canceled";var n=void 0===e?new Error("Promise canceled"):e;return a.ownCancelCallbacks.forEach((function(e){return e(n)})),a.cancelCallbacks.forEach((function(e){return e(n)})),a._reject(n),a.disposeCallbacks(),s(a)},a.onCancel=function(e){var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).signal;return a.cancelCallbacks.add(e),(0,c.isCancelableAbortSignal)(n)?n.subscribe((function(){a.cancelCallbacks.delete(e)})):null==n||n.addEventListener("abort",(function(){a.cancelCallbacks.delete(e)})),s(a)},a.onProgress=function(e){var n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).signal;return a.onProgressCallbacks.add(e),(0,c.isCancelableAbortSignal)(n)?n.subscribe((function(){a.onProgressCallbacks.delete(e)})):null==n||n.addEventListener("abort",(function(){a.onProgressCallbacks.delete(e)})),s(a)},a.reportProgress=function(e,n){return a.onProgressCallbacks.forEach((function(t){return t(e,n)})),s(a)},a.createChildPromise=function(){var e,n,t=new i((function(t,r,o){e=t,n=r}));return t.onProgressCallbacks=a.onProgressCallbacks,t.onCancel((function(e){a.cancel(e)})),{promise:t,resolve:e,reject:n}},a._resolve=u,a._reject=p,e((function(e){a.status="resolved",a.disposeCallbacks(),a._resolve(e)}),(function(e){a.status="rejected",a.disposeCallbacks(),a._reject(e)}),{cancel:function(e){return a.cancel(e)},onCancel:function(e){return a.subscribeToOwnCancelEvent(e)},onProgress:function(e){return a.onProgress(e),function(){a.onProgressCallbacks.delete(e)}},reportProgress:function(e,n){a.reportProgress(e,n)}}),a.then=function(e,t){var r=a.createChildPromise(),o=r.promise,c=r.resolve,l=r.reject;return f((n=s(a),y(i.prototype)),"then",n).call(n,e,t).then(c,l),o},a.catch=function(e){var n=a.createChildPromise(),r=n.promise,o=n.resolve,c=n.reject;return f((t=s(a),y(i.prototype)),"catch",t).call(t,e).then(o,c),r},a.finally=function(e){var n=a.createChildPromise(),t=n.promise,o=n.resolve,c=n.reject;return f((r=s(a),y(i.prototype)),"finally",r).call(r,e).then(o,c),t},a}return n=i,r=[{key:"resolve",value:function(e){return new i((function(n){return n(e)}))}}],(t=null)&&a(n.prototype,t),r&&a(n,r),Object.defineProperty(n,"prototype",{writable:!1}),i}(p(Promise));n.CancelablePromise=m,o=l.promise_identifier,m.reject=function(e){return new m((function(n,t){return t(e)}))},m.canceled=function(e){return new m((function(n,t,r){return(0,r.cancel)(e)}))},m.race=function(e){return new m((function(n,t,r){var o=r.onCancel,c=r.cancel;e.forEach((function(e){var r=h(e);o((function(e){r.cancel(e)})),r.then(n,(function(e){"canceled"!==r.status?t(e):c(e)}))}))}))},m.all=function(e){return new m((function(n,t,r){var o=r.onCancel,c=r.cancel,l=new Map,i=e.length,a=0;e.forEach((function(e){var r=h(e);l.set(r,null),o((function(e){r.cancel(e)})),r.then((function(e){a++,l.set(r,e),a===i&&n(Array.from(l.values()))}),(function(e){"canceled"!==r.status?t(e):c(e)}))}))}))},m.allSettled=function(e){return new m((function(n,t,r){var o=r.onCancel,c=new Map,l=e.length,i=0;e.forEach((function(e){var t=h(e);c.set(t,null),o((function(e){t.cancel(e)})),t.then((function(e){c.set(t,{status:"fulfilled",value:e})}),(function(e){c.set(t,{status:"canceled"===t.status?"canceled":"rejected",reason:e})})).finally((function(){++i===l&&n(Array.from(c.values()))}))}))}))},m.prototype.constructor=Promise;var h=function e(n){if((0,l.isCancelablePromise)(n))return n;if("function"==typeof n)return e(n());if(!(0,i.isPromise)(n))return new m((function(e){return e(n)}));var t,r,o=new m((function(e,o,c){t=e,r=o,n.then(t,r)}));return o.onCancel((function(e){r(e)})),o};n.toCancelablePromise=h},836:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.isCancelableAbortSignal=void 0;n.isCancelableAbortSignal=function(e){return Boolean(null==e?void 0:e.__is_cancelable_abort_signal)}},216:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.promise_identifier=n.isCancelablePromise=void 0;var t=Symbol("promise_identifier");n.promise_identifier=t;n.isCancelablePromise=function(e){return!!(null==e?void 0:e[t])}},790:(e,n)=>{Object.defineProperty(n,"__esModule",{value:!0}),n.isPromise=void 0;n.isPromise=function(e){return Promise.resolve(e)===e}},710:(e,n,t)=>{Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"toCancelablePromise",{enumerable:!0,get:function(){return r.toCancelablePromise}});var r=t(0)}},n={};function t(r){var o=n[r];if(void 0!==o)return o.exports;var c=n[r]={exports:{}};return e[r](c,c.exports,t),c.exports}var r={};return(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.groupAsCancelablePromise=void 0;var n=t(710),o=t(0);function c(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"==typeof e)return l(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return l(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}e.groupAsCancelablePromise=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e.length)return null;var r=t.maxConcurrent,l=void 0===r?8:r,i=t.executeInOrder,a=void 0!==i&&i,u=t.beforeEachCallback,s=void 0===u?null:u,f=t.afterEachCallback,p=void 0===f?null:f,b=t.onQueueEmptyCallback,d=void 0===b?null:b,v=c(e),y=[];return new o.CancelablePromise((function(t,r,o){(function t(){if(v.length){var r=v.splice(0,l).map((function(t){var r="function"==typeof t?t():t;null==s||s();var c=(0,n.toCancelablePromise)(r),l=o.onCancel((function(e){c.cancel(e)}));return c.then((function(n){var t,r;l(),y.push(n),null==p||p(n),o.reportProgress((null!==(t=y.length)&&void 0!==t?t:1)/(null!==(r=e.length)&&void 0!==r?r:1)*100)})),a?c.then((function(e){return e})):c}));return Promise.all(r).then((function(){return t()}))}})().then((function(){null==d||d(y),t(y)}))}))}})(),r})()));